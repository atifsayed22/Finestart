{% extends 'base.html' %}
{% load static %}

{% block title %}Startup Profile - FineStart{% endblock %}

{% block extra_css %}
<style>
    .profile-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
    }

    .profile-header {
        display: flex;
        align-items: center;
        gap: 2rem;
        margin-bottom: 2rem;
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .profile-picture-container {
        position: relative;
        width: 150px;
        height: 150px;
        border-radius: 50%;
        overflow: hidden;
        background: #f5f5f5;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }

    .profile-picture {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .profile-picture-placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: #ccc;
    }

    .change-photo-button {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(0,0,0,0.6);
        color: white;
        text-align: center;
        padding: 0.3rem 0;
        font-size: 0.8rem;
        opacity: 0;
        transition: opacity 0.3s;
    }

    .profile-picture-container:hover .change-photo-button {
        opacity: 1;
    }

    .profile-info {
        flex: 1;
    }

    .form-section {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        color: #1E3A8A;
        font-weight: 500;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-family: 'Poppins', sans-serif;
    }

    .form-group textarea {
        min-height: 150px;
        resize: vertical;
    }

    .save-button {
        background: linear-gradient(135deg, #4A90E2, #00BFA6);
        color: white;
        padding: 1rem 2rem;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: opacity 0.3s;
    }

    .save-button:hover {
        opacity: 0.9;
    }

    .file-upload-container {
        margin-top: 1rem;
    }

    .file-input-wrapper {
        position: relative;
        margin-bottom: 1rem;
    }

    .file-input {
        position: absolute;
        opacity: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
    }

    .file-input-button {
        display: inline-block;
        padding: 0.6rem 1.2rem;
        background: #f5f5f5;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 0.9rem;
        color: #333;
    }

    .file-name {
        margin-left: 0.5rem;
        font-size: 0.9rem;
        color: #666;
    }

    .file-preview-container {
        margin-top: 0.5rem;
        display: none;
    }

    .file-preview {
        max-width: 100%;
        max-height: 200px;
        border-radius: 4px;
    }

    .file-actions {
        display: flex;
        align-items: center;
        margin-top: 0.5rem;
    }

    .remove-file {
        color: #f44336;
        font-size: 0.8rem;
        cursor: pointer;
        text-decoration: underline;
    }

    .current-file {
        margin-top: 0.5rem;
        padding: 0.5rem;
        background: #f5f5f5;
        border-radius: 4px;
        display: flex;
        align-items: center;
    }

    .current-file-icon {
        margin-right: 0.5rem;
        font-size: 1.2rem;
        color: #4A90E2;
    }

    @media (max-width: 768px) {
        .profile-container {
            padding: 1rem;
        }
        
        .profile-header {
            flex-direction: column;
            text-align: center;
        }
    }

    /* Monthly Profit Tracking Styles */
    .monthly-profit-container {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        padding: 1rem;
        background-color: #f9f9f9;
        border-radius: 8px;
    }

    .current-profit {
        padding-bottom: 1rem;
        border-bottom: 1px solid #e0e0e0;
    }

    .profit-history-container h3 {
        font-size: 1.2rem;
        margin-bottom: 0.5rem;
        color: #333;
    }

    .profit-entries {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .profit-entry {
        display: flex;
        gap: 1rem;
        padding: 0.75rem;
        background-color: #ffffff;
        border-radius: 6px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        align-items: flex-end;
    }

    .month-selector {
        flex: 1;
    }

    .profit-amount {
        flex: 1;
    }

    @media (max-width: 768px) {
        .profit-entry {
            flex-direction: column;
            align-items: stretch;
        }
    }

    .profit-actions {
        margin-top: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .profit-chart-container {
        margin-top: 2rem;
        padding: 1rem;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .remove-entry-btn {
        background-color: #f44336;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 0.5rem;
        cursor: pointer;
        margin-left: 0.5rem;
        align-self: flex-end;
        height: 38px;
    }
    
    .remove-entry-btn:hover {
        background-color: #d32f2f;
    }
    
    #add-profit-entry {
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 0.75rem 1rem;
        cursor: pointer;
        font-weight: 500;
    }
    
    #add-profit-entry:hover {
        background-color: #3e8e41;
    }
</style>
{% endblock %}

{% block header %}
    {{ block.super }}
{% endblock %}

{% block content %}
    <main class="profile-container">
        {% if messages %}
            <div class="messages">
                {% for message in messages %}
                    <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        
        <div class="profile-header">
            <div class="profile-picture-container">
                {% if profile and profile.profile_picture %}
                    <img src="{{ profile.profile_picture.url }}" alt="Startup Logo" class="profile-picture" id="profile-picture-preview">
                {% else %}
                    <div class="profile-picture-placeholder">
                        <i class="fas fa-building"></i>
                    </div>
                {% endif %}
                <div class="change-photo-button">Change Photo</div>
            </div>
            <div class="profile-info">
                <h1>{% if profile %}Update{% else %}Create{% endif %} Startup Profile</h1>
                <p>{% if profile %}Update{% else %}Complete{% endif %} your startup information to attract potential investors</p>
            </div>
        </div>

        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            
            <!-- Hidden file input for profile picture -->
            <input type="file" id="profile-picture-input" name="profile_picture" accept="image/*" style="display: none;">
            
            <div class="form-section">
                <h2>Basic Information</h2>
                <div class="form-group">
                    <label for="startup-name">Startup Name</label>
                    <input type="text" id="startup-name" name="startup-name" value="{% if profile %}{{ profile.startup_name }}{% endif %}" required>
                </div>
                <div class="form-group">
                    <label for="industry">Industry</label>
                    <select id="industry" name="industry" required>
                        <option value="" disabled {% if not profile %}selected{% endif %}>Select an industry</option>
                        <option value="Technology" {% if profile and profile.industry == 'Technology' %}selected{% endif %}>Technology</option>
                        <option value="Healthcare" {% if profile and profile.industry == 'Healthcare' %}selected{% endif %}>Healthcare</option>
                        <option value="Finance" {% if profile and profile.industry == 'Finance' %}selected{% endif %}>Finance</option>
                        <option value="Education" {% if profile and profile.industry == 'Education' %}selected{% endif %}>Education</option>
                        <option value="E-commerce" {% if profile and profile.industry == 'E-commerce' %}selected{% endif %}>E-commerce</option>
                        <option value="Manufacturing" {% if profile and profile.industry == 'Manufacturing' %}selected{% endif %}>Manufacturing</option>
                        <option value="Real Estate" {% if profile and profile.industry == 'Real Estate' %}selected{% endif %}>Real Estate</option>
                        <option value="Entertainment" {% if profile and profile.industry == 'Entertainment' %}selected{% endif %}>Entertainment</option>
                        <option value="Food & Beverage" {% if profile and profile.industry == 'Food & Beverage' %}selected{% endif %}>Food & Beverage</option>
                        <option value="Transportation" {% if profile and profile.industry == 'Transportation' %}selected{% endif %}>Transportation</option>
                        <option value="Energy" {% if profile and profile.industry == 'Energy' %}selected{% endif %}>Energy</option>
                        <option value="Agriculture" {% if profile and profile.industry == 'Agriculture' %}selected{% endif %}>Agriculture</option>
                        <option value="Other" {% if profile and profile.industry == 'Other' %}selected{% endif %}>Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="company_description">Company Description</label>
                    <textarea id="company_description" name="company_description">{% if profile %}{{ profile.company_description }}{% endif %}</textarea>
                </div>
                <div class="form-group">
                    <label for="team_size">Team Size</label>
                    <input type="number" id="team_size" name="team_size" min="1" value="{% if profile %}{{ profile.team_size }}{% else %}1{% endif %}" required>
                </div>
                <div class="form-group">
                    <label for="ceo_name">CEO Name</label>
                    <input type="text" id="ceo_name" name="ceo_name" value="{% if profile %}{{ profile.ceo_name }}{% endif %}" required>
                </div>
                <div class="form-group">
                    <label for="monthly_profit">Monthly Profit ($)</label>
                    <input type="number" id="monthly_profit" name="monthly_profit" step="0.01" value="{% if profile %}{{ profile.monthly_profit }}{% else %}0{% endif %}" required>
                    <small class="text-muted">Your business's monthly earnings after all expenses</small>
                </div>
                
                <!-- Add a separate field for profit margin percentage -->
                <div class="form-group">
                    <label for="profit_margin">Profit Margin (%)</label>
                    <input type="number" id="profit_margin" name="profit_margin" step="0.1" min="0" max="100" 
                        value="{% if startup %}{{ startup.profit_margin }}{% else %}10{% endif %}" required>
                    <small class="text-muted">Percentage of revenue that is profit (e.g., 15 for 15%). This is different from the raw profit amount above. Maximum value is 100%.</small>
                </div>
            </div>

            <!-- Monthly Profit Tracking Section -->
            <div class="form-section">
                <h2>Monthly Profit Tracking</h2>
                <p>Track your startup's monthly profit to show growth to potential investors.</p>
                
                <div class="monthly-profit-container">
                    <div class="current-profit">
                        <h3>Current Monthly Profit</h3>
                        <p>This is the profit amount for the current month. To add historical data or update specific months, use the entries below.</p>
                    </div>
                    
                    <div class="profit-history-container">
                        <h3>Profit History</h3>
                        <div class="profit-entries" id="profit-entries-container">
                            <!-- Existing profit entries will be loaded here -->
                            {% if profit_entries %}
                                {% for entry in profit_entries %}
                                <div class="profit-entry" data-id="{{ entry.id }}">
                                    <div class="month-selector">
                                        <label>Month</label>
                                        <input type="month" class="form-control" value="{{ entry.date|date:'Y-m' }}" readonly>
                                    </div>
                                    <div class="profit-amount">
                                        <label>Amount ($)</label>
                                        <input type="number" class="form-control" value="{{ entry.amount }}" readonly>
                                    </div>
                                    <button class="remove-entry-btn" data-id="{{ entry.id }}">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                {% endfor %}
                            {% else %}
                                <p>No profit history entries yet. Add your first entry below.</p>
                            {% endif %}
                        </div>
                        
                        <div class="profit-entry new-entry">
                            <div class="month-selector">
                                <label>Month</label>
                                <input type="month" id="new-profit-month" class="form-control" required>
                            </div>
                            <div class="profit-amount">
                                <label>Amount ($)</label>
                                <input type="number" id="new-profit-amount" class="form-control" step="0.01" min="0" required>
                            </div>
                            <button id="add-profit-entry" class="btn btn-success">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="profit-chart-container">
                    <h3>Profit Trend</h3>
                    <canvas id="profitChart"></canvas>
                </div>
            </div>

            <!-- File Uploads Section -->
            <div class="form-section">
                <h2>Documents and Media</h2>
                <p>Upload documents and media to showcase your startup to potential investors.</p>
                
                <!-- Business Proposal Upload -->
                <div class="form-group">
                    <label>Business Proposal</label>
                    <div class="file-upload-container">
                        {% if startup and startup.business_proposal %}
                            <div class="current-file">
                                <span class="current-file-icon"><i class="fas fa-file-pdf"></i></span>
                                <a href="{{ startup.get_business_proposal_url }}" target="_blank">Current Business Proposal</a>
                            </div>
                        {% endif %}
                        
                        <div class="file-input-wrapper">
                            <input type="file" name="business_proposal" accept=".pdf,.doc,.docx" class="file-input" id="business-proposal-input">
                            <label for="business-proposal-input" class="file-input-button">Choose File</label>
                            <span class="file-name" id="business-proposal-name"></span>
                        </div>
                    </div>
                </div>
                
                <!-- Legal Documents Upload -->
                <div class="form-group">
                    <label>Legal Documents</label>
                    <div class="file-upload-container">
                        {% if startup and startup.legal_documents %}
                            <div class="current-file">
                                <span class="current-file-icon"><i class="fas fa-file-contract"></i></span>
                                <a href="{{ startup.get_legal_documents_url }}" target="_blank">Current Legal Documents</a>
                            </div>
                        {% endif %}
                        
                        <div class="file-input-wrapper">
                            <input type="file" name="legal_documents" accept=".pdf,.doc,.docx" class="file-input" id="legal-documents-input">
                            <label for="legal-documents-input" class="file-input-button">Choose File</label>
                            <span class="file-name" id="legal-documents-name"></span>
                        </div>
                    </div>
                </div>
                
                <!-- Pitch Video Upload -->
                <div class="form-group">
                    <label>Pitch Video</label>
                    <div class="file-upload-container">
                        {% if startup and startup.pitch_video %}
                            <div class="current-file">
                                <span class="current-file-icon"><i class="fas fa-video"></i></span>
                                <a href="{{ startup.get_pitch_video_url }}" target="_blank">Current Pitch Video</a>
                            </div>
                        {% endif %}
                        
                        <div class="file-input-wrapper">
                            <input type="file" name="pitch_video" accept="video/*" class="file-input" id="pitch-video-input">
                            <label for="pitch-video-input" class="file-input-button">Choose File</label>
                            <span class="file-name" id="pitch-video-name"></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2>Business Details</h2>
                <div class="form-group">
                    <label for="startup_stage">Startup Stage</label>
                    <select id="startup_stage" name="startup_stage" required>
                        <option value="idea" {% if profile and profile.startup_stage == 'idea' %}selected{% endif %}>Idea Stage</option>
                        <option value="mvp" {% if profile and profile.startup_stage == 'mvp' %}selected{% endif %}>MVP Ready</option>
                        <option value="early_traction" {% if profile and profile.startup_stage == 'early_traction' %}selected{% endif %}>Early Traction</option>
                        <option value="scaling" {% if profile and profile.startup_stage == 'scaling' %}selected{% endif %}>Scaling</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="business_model">Business Model</label>
                    <select id="business_model" name="business_model" required>
                        <option value="b2b" {% if profile and profile.business_model == 'b2b' %}selected{% endif %}>B2B</option>
                        <option value="b2c" {% if profile and profile.business_model == 'b2c' %}selected{% endif %}>B2C</option>
                        <option value="b2b2c" {% if profile and profile.business_model == 'b2b2c' %}selected{% endif %}>B2B2C</option>
                        <option value="marketplace" {% if profile and profile.business_model == 'marketplace' %}selected{% endif %}>Marketplace</option>
                        <option value="saas" {% if profile and profile.business_model == 'saas' %}selected{% endif %}>SaaS</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="equity_structure">Equity Structure</label>
                    <textarea id="equity_structure" name="equity_structure">{% if profile %}{{ profile.equity_structure }}{% endif %}</textarea>
                </div>

                <!-- Growth Trend for syncing with Startup model -->
                <div class="form-group">
                    <label for="growth_trend">Growth Trend</label>
                    <select id="growth_trend" name="growth_trend" required>
                        <option value="growing" {% if startup and startup.growth_trend == 'growing' %}selected{% endif %}>Growing</option>
                        <option value="stable" {% if startup and startup.growth_trend == 'stable' %}selected{% endif %}>Stable</option>
                        <option value="declining" {% if startup and startup.growth_trend == 'declining' %}selected{% endif %}>Declining</option>
                    </select>
                </div>
                
                <!-- Investment Required -->
                <div class="form-group">
                    <label for="investment_required">Investment Required ($)</label>
                    <input type="number" id="investment_required" name="investment_required" step="1000" min="0" 
                        value="{% if startup %}{{ startup.investment_required }}{% else %}50000{% endif %}">
                </div>
                
                <!-- Target Market -->
                <div class="form-group">
                    <label for="target_market">Target Market</label>
                    <textarea id="target_market" name="target_market">{% if startup %}{{ startup.target_market }}{% else %}{% endif %}</textarea>
                </div>
            </div>

            <div class="form-section">
                <h2>Contact Information</h2>
                <div class="form-group">
                    <label for="website">Website URL</label>
                    <input type="url" id="website" name="website" value="{% if profile and profile.website %}{{ profile.website }}{% endif %}" placeholder="https://example.com">
                </div>
                <div class="form-group">
                    <label for="contact_email">Contact Email</label>
                    <input type="email" id="contact_email" name="contact_email" value="{% if profile and profile.contact_email %}{{ profile.contact_email }}{% elif user %}{{ user.email }}{% endif %}" required placeholder="contact@yourstartup.com">
                </div>
                <div class="form-group">
                    <label for="phone_number">Phone Number</label>
                    <input type="tel" id="phone_number" name="phone_number" value="{% if profile and profile.phone_number %}{{ profile.phone_number }}{% endif %}" placeholder="+1 (123) 456-7890">
                </div>
                <div class="form-group">
                    <label for="location">City</label>
                    <input type="text" id="location" name="location" value="{% if profile and profile.location %}{{ profile.location }}{% endif %}" placeholder="New York, San Francisco, etc.">
                </div>

                <!-- Add Country dropdown -->
                <div class="form-group">
                    <label for="country">Country</label>
                    <select id="country" name="country" class="form-control">
                        <option value="">Select Country</option>
                        <option value="Afghanistan" {% if profile and profile.country == 'Afghanistan' %}selected{% endif %}>Afghanistan</option>
                        <option value="Albania" {% if profile and profile.country == 'Albania' %}selected{% endif %}>Albania</option>
                        <option value="Algeria" {% if profile and profile.country == 'Algeria' %}selected{% endif %}>Algeria</option>
                        <option value="Andorra" {% if profile and profile.country == 'Andorra' %}selected{% endif %}>Andorra</option>
                        <option value="Angola" {% if profile and profile.country == 'Angola' %}selected{% endif %}>Angola</option>
                        <option value="Antigua and Barbuda" {% if profile and profile.country == 'Antigua and Barbuda' %}selected{% endif %}>Antigua and Barbuda</option>
                        <option value="Argentina" {% if profile and profile.country == 'Argentina' %}selected{% endif %}>Argentina</option>
                        <option value="Armenia" {% if profile and profile.country == 'Armenia' %}selected{% endif %}>Armenia</option>
                        <option value="Australia" {% if profile and profile.country == 'Australia' %}selected{% endif %}>Australia</option>
                        <option value="Austria" {% if profile and profile.country == 'Austria' %}selected{% endif %}>Austria</option>
                        <option value="Azerbaijan" {% if profile and profile.country == 'Azerbaijan' %}selected{% endif %}>Azerbaijan</option>
                        <option value="Bahamas" {% if profile and profile.country == 'Bahamas' %}selected{% endif %}>Bahamas</option>
                        <option value="Bahrain" {% if profile and profile.country == 'Bahrain' %}selected{% endif %}>Bahrain</option>
                        <option value="Bangladesh" {% if profile and profile.country == 'Bangladesh' %}selected{% endif %}>Bangladesh</option>
                        <option value="Barbados" {% if profile and profile.country == 'Barbados' %}selected{% endif %}>Barbados</option>
                        <option value="Belarus" {% if profile and profile.country == 'Belarus' %}selected{% endif %}>Belarus</option>
                        <option value="Belgium" {% if profile and profile.country == 'Belgium' %}selected{% endif %}>Belgium</option>
                        <option value="Belize" {% if profile and profile.country == 'Belize' %}selected{% endif %}>Belize</option>
                        <option value="Benin" {% if profile and profile.country == 'Benin' %}selected{% endif %}>Benin</option>
                        <option value="Bhutan" {% if profile and profile.country == 'Bhutan' %}selected{% endif %}>Bhutan</option>
                        <option value="Bolivia" {% if profile and profile.country == 'Bolivia' %}selected{% endif %}>Bolivia</option>
                        <option value="Bosnia and Herzegovina" {% if profile and profile.country == 'Bosnia and Herzegovina' %}selected{% endif %}>Bosnia and Herzegovina</option>
                        <option value="Botswana" {% if profile and profile.country == 'Botswana' %}selected{% endif %}>Botswana</option>
                        <option value="Brazil" {% if profile and profile.country == 'Brazil' %}selected{% endif %}>Brazil</option>
                        <option value="Brunei" {% if profile and profile.country == 'Brunei' %}selected{% endif %}>Brunei</option>
                        <option value="Bulgaria" {% if profile and profile.country == 'Bulgaria' %}selected{% endif %}>Bulgaria</option>
                        <option value="Burkina Faso" {% if profile and profile.country == 'Burkina Faso' %}selected{% endif %}>Burkina Faso</option>
                        <option value="Burundi" {% if profile and profile.country == 'Burundi' %}selected{% endif %}>Burundi</option>
                        <option value="Cabo Verde" {% if profile and profile.country == 'Cabo Verde' %}selected{% endif %}>Cabo Verde</option>
                        <option value="Cambodia" {% if profile and profile.country == 'Cambodia' %}selected{% endif %}>Cambodia</option>
                        <option value="Cameroon" {% if profile and profile.country == 'Cameroon' %}selected{% endif %}>Cameroon</option>
                        <option value="Canada" {% if profile and profile.country == 'Canada' %}selected{% endif %}>Canada</option>
                        <option value="Central African Republic" {% if profile and profile.country == 'Central African Republic' %}selected{% endif %}>Central African Republic</option>
                        <option value="Chad" {% if profile and profile.country == 'Chad' %}selected{% endif %}>Chad</option>
                        <option value="Chile" {% if profile and profile.country == 'Chile' %}selected{% endif %}>Chile</option>
                        <option value="China" {% if profile and profile.country == 'China' %}selected{% endif %}>China</option>
                        <option value="Colombia" {% if profile and profile.country == 'Colombia' %}selected{% endif %}>Colombia</option>
                        <option value="Comoros" {% if profile and profile.country == 'Comoros' %}selected{% endif %}>Comoros</option>
                        <option value="Congo" {% if profile and profile.country == 'Congo' %}selected{% endif %}>Congo</option>
                        <option value="Costa Rica" {% if profile and profile.country == 'Costa Rica' %}selected{% endif %}>Costa Rica</option>
                        <option value="Croatia" {% if profile and profile.country == 'Croatia' %}selected{% endif %}>Croatia</option>
                        <option value="Cuba" {% if profile and profile.country == 'Cuba' %}selected{% endif %}>Cuba</option>
                        <option value="Cyprus" {% if profile and profile.country == 'Cyprus' %}selected{% endif %}>Cyprus</option>
                        <option value="Czech Republic" {% if profile and profile.country == 'Czech Republic' %}selected{% endif %}>Czech Republic</option>
                        <option value="Denmark" {% if profile and profile.country == 'Denmark' %}selected{% endif %}>Denmark</option>
                        <option value="Djibouti" {% if profile and profile.country == 'Djibouti' %}selected{% endif %}>Djibouti</option>
                        <option value="Dominica" {% if profile and profile.country == 'Dominica' %}selected{% endif %}>Dominica</option>
                        <option value="Dominican Republic" {% if profile and profile.country == 'Dominican Republic' %}selected{% endif %}>Dominican Republic</option>
                        <option value="Ecuador" {% if profile and profile.country == 'Ecuador' %}selected{% endif %}>Ecuador</option>
                        <option value="Egypt" {% if profile and profile.country == 'Egypt' %}selected{% endif %}>Egypt</option>
                        <option value="El Salvador" {% if profile and profile.country == 'El Salvador' %}selected{% endif %}>El Salvador</option>
                        <option value="Equatorial Guinea" {% if profile and profile.country == 'Equatorial Guinea' %}selected{% endif %}>Equatorial Guinea</option>
                        <option value="Eritrea" {% if profile and profile.country == 'Eritrea' %}selected{% endif %}>Eritrea</option>
                        <option value="Estonia" {% if profile and profile.country == 'Estonia' %}selected{% endif %}>Estonia</option>
                        <option value="Eswatini" {% if profile and profile.country == 'Eswatini' %}selected{% endif %}>Eswatini</option>
                        <option value="Ethiopia" {% if profile and profile.country == 'Ethiopia' %}selected{% endif %}>Ethiopia</option>
                        <option value="Fiji" {% if profile and profile.country == 'Fiji' %}selected{% endif %}>Fiji</option>
                        <option value="Finland" {% if profile and profile.country == 'Finland' %}selected{% endif %}>Finland</option>
                        <option value="France" {% if profile and profile.country == 'France' %}selected{% endif %}>France</option>
                        <option value="Gabon" {% if profile and profile.country == 'Gabon' %}selected{% endif %}>Gabon</option>
                        <option value="Gambia" {% if profile and profile.country == 'Gambia' %}selected{% endif %}>Gambia</option>
                        <option value="Georgia" {% if profile and profile.country == 'Georgia' %}selected{% endif %}>Georgia</option>
                        <option value="Germany" {% if profile and profile.country == 'Germany' %}selected{% endif %}>Germany</option>
                        <option value="Ghana" {% if profile and profile.country == 'Ghana' %}selected{% endif %}>Ghana</option>
                        <option value="Greece" {% if profile and profile.country == 'Greece' %}selected{% endif %}>Greece</option>
                        <option value="Grenada" {% if profile and profile.country == 'Grenada' %}selected{% endif %}>Grenada</option>
                        <option value="Guatemala" {% if profile and profile.country == 'Guatemala' %}selected{% endif %}>Guatemala</option>
                        <option value="Guinea" {% if profile and profile.country == 'Guinea' %}selected{% endif %}>Guinea</option>
                        <option value="Guinea-Bissau" {% if profile and profile.country == 'Guinea-Bissau' %}selected{% endif %}>Guinea-Bissau</option>
                        <option value="Guyana" {% if profile and profile.country == 'Guyana' %}selected{% endif %}>Guyana</option>
                        <option value="Haiti" {% if profile and profile.country == 'Haiti' %}selected{% endif %}>Haiti</option>
                        <option value="Honduras" {% if profile and profile.country == 'Honduras' %}selected{% endif %}>Honduras</option>
                        <option value="Hungary" {% if profile and profile.country == 'Hungary' %}selected{% endif %}>Hungary</option>
                        <option value="Iceland" {% if profile and profile.country == 'Iceland' %}selected{% endif %}>Iceland</option>
                        <option value="India" {% if profile and profile.country == 'India' %}selected{% endif %}>India</option>
                        <option value="Indonesia" {% if profile and profile.country == 'Indonesia' %}selected{% endif %}>Indonesia</option>
                        <option value="Iran" {% if profile and profile.country == 'Iran' %}selected{% endif %}>Iran</option>
                        <option value="Iraq" {% if profile and profile.country == 'Iraq' %}selected{% endif %}>Iraq</option>
                        <option value="Ireland" {% if profile and profile.country == 'Ireland' %}selected{% endif %}>Ireland</option>
                        <option value="Israel" {% if profile and profile.country == 'Israel' %}selected{% endif %}>Israel</option>
                        <option value="Italy" {% if profile and profile.country == 'Italy' %}selected{% endif %}>Italy</option>
                        <option value="Jamaica" {% if profile and profile.country == 'Jamaica' %}selected{% endif %}>Jamaica</option>
                        <option value="Japan" {% if profile and profile.country == 'Japan' %}selected{% endif %}>Japan</option>
                        <option value="Jordan" {% if profile and profile.country == 'Jordan' %}selected{% endif %}>Jordan</option>
                        <option value="Kazakhstan" {% if profile and profile.country == 'Kazakhstan' %}selected{% endif %}>Kazakhstan</option>
                        <option value="Kenya" {% if profile and profile.country == 'Kenya' %}selected{% endif %}>Kenya</option>
                        <option value="Kiribati" {% if profile and profile.country == 'Kiribati' %}selected{% endif %}>Kiribati</option>
                        <option value="North Korea" {% if profile and profile.country == 'North Korea' %}selected{% endif %}>North Korea</option>
                        <option value="South Korea" {% if profile and profile.country == 'South Korea' %}selected{% endif %}>South Korea</option>
                        <option value="Kuwait" {% if profile and profile.country == 'Kuwait' %}selected{% endif %}>Kuwait</option>
                        <option value="Kyrgyzstan" {% if profile and profile.country == 'Kyrgyzstan' %}selected{% endif %}>Kyrgyzstan</option>
                        <option value="Laos" {% if profile and profile.country == 'Laos' %}selected{% endif %}>Laos</option>
                        <option value="Latvia" {% if profile and profile.country == 'Latvia' %}selected{% endif %}>Latvia</option>
                        <option value="Lebanon" {% if profile and profile.country == 'Lebanon' %}selected{% endif %}>Lebanon</option>
                        <option value="Lesotho" {% if profile and profile.country == 'Lesotho' %}selected{% endif %}>Lesotho</option>
                        <option value="Liberia" {% if profile and profile.country == 'Liberia' %}selected{% endif %}>Liberia</option>
                        <option value="Libya" {% if profile and profile.country == 'Libya' %}selected{% endif %}>Libya</option>
                        <option value="Liechtenstein" {% if profile and profile.country == 'Liechtenstein' %}selected{% endif %}>Liechtenstein</option>
                        <option value="Lithuania" {% if profile and profile.country == 'Lithuania' %}selected{% endif %}>Lithuania</option>
                        <option value="Luxembourg" {% if profile and profile.country == 'Luxembourg' %}selected{% endif %}>Luxembourg</option>
                        <option value="Madagascar" {% if profile and profile.country == 'Madagascar' %}selected{% endif %}>Madagascar</option>
                        <option value="Malawi" {% if profile and profile.country == 'Malawi' %}selected{% endif %}>Malawi</option>
                        <option value="Malaysia" {% if profile and profile.country == 'Malaysia' %}selected{% endif %}>Malaysia</option>
                        <option value="Maldives" {% if profile and profile.country == 'Maldives' %}selected{% endif %}>Maldives</option>
                        <option value="Mali" {% if profile and profile.country == 'Mali' %}selected{% endif %}>Mali</option>
                        <option value="Malta" {% if profile and profile.country == 'Malta' %}selected{% endif %}>Malta</option>
                        <option value="Marshall Islands" {% if profile and profile.country == 'Marshall Islands' %}selected{% endif %}>Marshall Islands</option>
                        <option value="Mauritania" {% if profile and profile.country == 'Mauritania' %}selected{% endif %}>Mauritania</option>
                        <option value="Mauritius" {% if profile and profile.country == 'Mauritius' %}selected{% endif %}>Mauritius</option>
                        <option value="Mexico" {% if profile and profile.country == 'Mexico' %}selected{% endif %}>Mexico</option>
                        <option value="Micronesia" {% if profile and profile.country == 'Micronesia' %}selected{% endif %}>Micronesia</option>
                        <option value="Moldova" {% if profile and profile.country == 'Moldova' %}selected{% endif %}>Moldova</option>
                        <option value="Monaco" {% if profile and profile.country == 'Monaco' %}selected{% endif %}>Monaco</option>
                        <option value="Mongolia" {% if profile and profile.country == 'Mongolia' %}selected{% endif %}>Mongolia</option>
                        <option value="Montenegro" {% if profile and profile.country == 'Montenegro' %}selected{% endif %}>Montenegro</option>
                        <option value="Morocco" {% if profile and profile.country == 'Morocco' %}selected{% endif %}>Morocco</option>
                        <option value="Mozambique" {% if profile and profile.country == 'Mozambique' %}selected{% endif %}>Mozambique</option>
                        <option value="Myanmar" {% if profile and profile.country == 'Myanmar' %}selected{% endif %}>Myanmar</option>
                        <option value="Namibia" {% if profile and profile.country == 'Namibia' %}selected{% endif %}>Namibia</option>
                        <option value="Nauru" {% if profile and profile.country == 'Nauru' %}selected{% endif %}>Nauru</option>
                        <option value="Nepal" {% if profile and profile.country == 'Nepal' %}selected{% endif %}>Nepal</option>
                        <option value="Netherlands" {% if profile and profile.country == 'Netherlands' %}selected{% endif %}>Netherlands</option>
                        <option value="New Zealand" {% if profile and profile.country == 'New Zealand' %}selected{% endif %}>New Zealand</option>
                        <option value="Nicaragua" {% if profile and profile.country == 'Nicaragua' %}selected{% endif %}>Nicaragua</option>
                        <option value="Niger" {% if profile and profile.country == 'Niger' %}selected{% endif %}>Niger</option>
                        <option value="Nigeria" {% if profile and profile.country == 'Nigeria' %}selected{% endif %}>Nigeria</option>
                        <option value="North Macedonia" {% if profile and profile.country == 'North Macedonia' %}selected{% endif %}>North Macedonia</option>
                        <option value="Norway" {% if profile and profile.country == 'Norway' %}selected{% endif %}>Norway</option>
                        <option value="Oman" {% if profile and profile.country == 'Oman' %}selected{% endif %}>Oman</option>
                        <option value="Pakistan" {% if profile and profile.country == 'Pakistan' %}selected{% endif %}>Pakistan</option>
                        <option value="Palau" {% if profile and profile.country == 'Palau' %}selected{% endif %}>Palau</option>
                        <option value="Palestine" {% if profile and profile.country == 'Palestine' %}selected{% endif %}>Palestine</option>
                        <option value="Panama" {% if profile and profile.country == 'Panama' %}selected{% endif %}>Panama</option>
                        <option value="Papua New Guinea" {% if profile and profile.country == 'Papua New Guinea' %}selected{% endif %}>Papua New Guinea</option>
                        <option value="Paraguay" {% if profile and profile.country == 'Paraguay' %}selected{% endif %}>Paraguay</option>
                        <option value="Peru" {% if profile and profile.country == 'Peru' %}selected{% endif %}>Peru</option>
                        <option value="Philippines" {% if profile and profile.country == 'Philippines' %}selected{% endif %}>Philippines</option>
                        <option value="Poland" {% if profile and profile.country == 'Poland' %}selected{% endif %}>Poland</option>
                        <option value="Portugal" {% if profile and profile.country == 'Portugal' %}selected{% endif %}>Portugal</option>
                        <option value="Qatar" {% if profile and profile.country == 'Qatar' %}selected{% endif %}>Qatar</option>
                        <option value="Romania" {% if profile and profile.country == 'Romania' %}selected{% endif %}>Romania</option>
                        <option value="Russia" {% if profile and profile.country == 'Russia' %}selected{% endif %}>Russia</option>
                        <option value="Rwanda" {% if profile and profile.country == 'Rwanda' %}selected{% endif %}>Rwanda</option>
                        <option value="Saint Kitts and Nevis" {% if profile and profile.country == 'Saint Kitts and Nevis' %}selected{% endif %}>Saint Kitts and Nevis</option>
                        <option value="Saint Lucia" {% if profile and profile.country == 'Saint Lucia' %}selected{% endif %}>Saint Lucia</option>
                        <option value="Saint Vincent and the Grenadines" {% if profile and profile.country == 'Saint Vincent and the Grenadines' %}selected{% endif %}>Saint Vincent and the Grenadines</option>
                        <option value="Samoa" {% if profile and profile.country == 'Samoa' %}selected{% endif %}>Samoa</option>
                        <option value="San Marino" {% if profile and profile.country == 'San Marino' %}selected{% endif %}>San Marino</option>
                        <option value="Sao Tome and Principe" {% if profile and profile.country == 'Sao Tome and Principe' %}selected{% endif %}>Sao Tome and Principe</option>
                        <option value="Saudi Arabia" {% if profile and profile.country == 'Saudi Arabia' %}selected{% endif %}>Saudi Arabia</option>
                        <option value="Senegal" {% if profile and profile.country == 'Senegal' %}selected{% endif %}>Senegal</option>
                        <option value="Serbia" {% if profile and profile.country == 'Serbia' %}selected{% endif %}>Serbia</option>
                        <option value="Seychelles" {% if profile and profile.country == 'Seychelles' %}selected{% endif %}>Seychelles</option>
                        <option value="Sierra Leone" {% if profile and profile.country == 'Sierra Leone' %}selected{% endif %}>Sierra Leone</option>
                        <option value="Singapore" {% if profile and profile.country == 'Singapore' %}selected{% endif %}>Singapore</option>
                        <option value="Slovakia" {% if profile and profile.country == 'Slovakia' %}selected{% endif %}>Slovakia</option>
                        <option value="Slovenia" {% if profile and profile.country == 'Slovenia' %}selected{% endif %}>Slovenia</option>
                        <option value="Solomon Islands" {% if profile and profile.country == 'Solomon Islands' %}selected{% endif %}>Solomon Islands</option>
                        <option value="Somalia" {% if profile and profile.country == 'Somalia' %}selected{% endif %}>Somalia</option>
                        <option value="South Africa" {% if profile and profile.country == 'South Africa' %}selected{% endif %}>South Africa</option>
                        <option value="South Sudan" {% if profile and profile.country == 'South Sudan' %}selected{% endif %}>South Sudan</option>
                        <option value="Spain" {% if profile and profile.country == 'Spain' %}selected{% endif %}>Spain</option>
                        <option value="Sri Lanka" {% if profile and profile.country == 'Sri Lanka' %}selected{% endif %}>Sri Lanka</option>
                        <option value="Sudan" {% if profile and profile.country == 'Sudan' %}selected{% endif %}>Sudan</option>
                        <option value="Suriname" {% if profile and profile.country == 'Suriname' %}selected{% endif %}>Suriname</option>
                        <option value="Sweden" {% if profile and profile.country == 'Sweden' %}selected{% endif %}>Sweden</option>
                        <option value="Switzerland" {% if profile and profile.country == 'Switzerland' %}selected{% endif %}>Switzerland</option>
                        <option value="Syria" {% if profile and profile.country == 'Syria' %}selected{% endif %}>Syria</option>
                        <option value="Taiwan" {% if profile and profile.country == 'Taiwan' %}selected{% endif %}>Taiwan</option>
                        <option value="Tajikistan" {% if profile and profile.country == 'Tajikistan' %}selected{% endif %}>Tajikistan</option>
                        <option value="Tanzania" {% if profile and profile.country == 'Tanzania' %}selected{% endif %}>Tanzania</option>
                        <option value="Thailand" {% if profile and profile.country == 'Thailand' %}selected{% endif %}>Thailand</option>
                        <option value="Timor-Leste" {% if profile and profile.country == 'Timor-Leste' %}selected{% endif %}>Timor-Leste</option>
                        <option value="Togo" {% if profile and profile.country == 'Togo' %}selected{% endif %}>Togo</option>
                        <option value="Tonga" {% if profile and profile.country == 'Tonga' %}selected{% endif %}>Tonga</option>
                        <option value="Trinidad and Tobago" {% if profile and profile.country == 'Trinidad and Tobago' %}selected{% endif %}>Trinidad and Tobago</option>
                        <option value="Tunisia" {% if profile and profile.country == 'Tunisia' %}selected{% endif %}>Tunisia</option>
                        <option value="Turkey" {% if profile and profile.country == 'Turkey' %}selected{% endif %}>Turkey</option>
                        <option value="Turkmenistan" {% if profile and profile.country == 'Turkmenistan' %}selected{% endif %}>Turkmenistan</option>
                        <option value="Tuvalu" {% if profile and profile.country == 'Tuvalu' %}selected{% endif %}>Tuvalu</option>
                        <option value="Uganda" {% if profile and profile.country == 'Uganda' %}selected{% endif %}>Uganda</option>
                        <option value="Ukraine" {% if profile and profile.country == 'Ukraine' %}selected{% endif %}>Ukraine</option>
                        <option value="United Arab Emirates" {% if profile and profile.country == 'United Arab Emirates' %}selected{% endif %}>United Arab Emirates</option>
                        <option value="United Kingdom" {% if profile and profile.country == 'United Kingdom' %}selected{% endif %}>United Kingdom</option>
                        <option value="United States" {% if profile and profile.country == 'United States' %}selected{% endif %}>United States</option>
                        <option value="Uruguay" {% if profile and profile.country == 'Uruguay' %}selected{% endif %}>Uruguay</option>
                        <option value="Uzbekistan" {% if profile and profile.country == 'Uzbekistan' %}selected{% endif %}>Uzbekistan</option>
                        <option value="Vanuatu" {% if profile and profile.country == 'Vanuatu' %}selected{% endif %}>Vanuatu</option>
                        <option value="Vatican City" {% if profile and profile.country == 'Vatican City' %}selected{% endif %}>Vatican City</option>
                        <option value="Venezuela" {% if profile and profile.country == 'Venezuela' %}selected{% endif %}>Venezuela</option>
                        <option value="Vietnam" {% if profile and profile.country == 'Vietnam' %}selected{% endif %}>Vietnam</option>
                        <option value="Yemen" {% if profile and profile.country == 'Yemen' %}selected{% endif %}>Yemen</option>
                        <option value="Zambia" {% if profile and profile.country == 'Zambia' %}selected{% endif %}>Zambia</option>
                        <option value="Zimbabwe" {% if profile and profile.country == 'Zimbabwe' %}selected{% endif %}>Zimbabwe</option>
                    </select>
                </div>
            </div>

            <button type="submit" class="save-button">
                {% if profile %}Update{% else %}Save{% endif %} Profile
            </button>
        </form>
    </main>
{% endblock %}

{% block extra_js %}
<!-- Initialize data from Django context -->
<script>
    // Global variables for profit data - convert Django template data to valid JavaScript
    var profitLabels = JSON.parse('{% if profit_data %}{{ profit_data.labels|escapejs }}{% else %}[]{% endif %}');
    var profitValues = JSON.parse('{% if profit_data %}{{ profit_data.values|escapejs }}{% else %}[]{% endif %}');
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Profile picture upload
        const profilePictureContainer = document.querySelector('.profile-picture-container');
        const profilePictureInput = document.getElementById('profile-picture-input');
        const profilePicturePreview = document.getElementById('profile-picture-preview');
        
        if (profilePictureContainer && profilePictureInput) {
            profilePictureContainer.addEventListener('click', function() {
                profilePictureInput.click();
            });
            
            profilePictureInput.addEventListener('change', function() {
                if (this.files && this.files[0]) {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        // If there's already a preview image
                        if (profilePicturePreview) {
                            profilePicturePreview.src = e.target.result;
                        } else {
                            // If there's a placeholder, replace it with an image
                            const placeholder = profilePictureContainer.querySelector('.profile-picture-placeholder');
                            if (placeholder) {
                                placeholder.remove();
                                
                                const img = document.createElement('img');
                                img.src = e.target.result;
                                img.alt = "Startup Logo";
                                img.classList.add('profile-picture');
                                img.id = 'profile-picture-preview';
                                profilePictureContainer.prepend(img);
                            }
                        }
                    };
                    
                    reader.readAsDataURL(this.files[0]);
                }
            });
        }
        
        // Profit margin validation
        const profitMarginInput = document.getElementById('profit_margin');
        if (profitMarginInput) {
            profitMarginInput.addEventListener('input', function() {
                // Ensure value doesn't exceed 100
                if (parseFloat(this.value) > 100) {
                    this.value = 100;
                }
            });
        }
        
        // Handle all file inputs
        const fileInputs = document.querySelectorAll('.file-input');
        fileInputs.forEach(input => {
            const fileNameElement = document.getElementById(input.id + '-name');
            if (fileNameElement) {
                input.addEventListener('change', function() {
                    if (this.files && this.files[0]) {
                        fileNameElement.textContent = this.files[0].name;
                    } else {
                        fileNameElement.textContent = '';
                    }
                });
            }
        });
        
        // Monthly Profit Tracking
        const addProfitButton = document.getElementById('add-profit-entry');
        const newProfitMonth = document.getElementById('new-profit-month');
        const newProfitAmount = document.getElementById('new-profit-amount');
        const profitEntriesContainer = document.getElementById('profit-entries-container');
        
        if (addProfitButton && newProfitMonth && newProfitAmount) {
            // Set default month to current month
            const now = new Date();
            const year = now.getFullYear();
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            newProfitMonth.value = `${year}-${month}`;
            
            addProfitButton.addEventListener('click', function(e) {
                e.preventDefault();
                
                if (!newProfitMonth.value || !newProfitAmount.value) {
                    alert('Please enter both month and profit amount');
                    return;
                }
                
                // Create data for AJAX request
                const data = {
                    date: newProfitMonth.value + '-01', // Add day to make a valid date
                    amount: newProfitAmount.value
                };
                
                // Send AJAX request to add profit entry
                fetch('{% url "startup:add_profit_entry" %}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCsrfToken() // Function to get CSRF token
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Create new entry in UI
                        const entryDate = new Date(newProfitMonth.value + '-01');
                        const formattedDate = entryDate.toLocaleString('default', { month: 'long', year: 'numeric' });
                        
                        const newEntry = document.createElement('div');
                        newEntry.className = 'profit-entry';
                        newEntry.dataset.id = data.profit_id;
                        newEntry.innerHTML = `
                            <div class="month-selector">
                                <label>Month</label>
                                <input type="month" class="form-control" value="${newProfitMonth.value}" readonly>
                            </div>
                            <div class="profit-amount">
                                <label>Amount ($)</label>
                                <input type="number" class="form-control" value="${newProfitAmount.value}" readonly>
                            </div>
                            <button class="remove-entry-btn" data-id="${data.profit_id}">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                        
                        // Add the new entry to the container
                        if (profitEntriesContainer.querySelector('p')) {
                            profitEntriesContainer.innerHTML = ''; // Remove "no entries" message
                        }
                        
                        profitEntriesContainer.appendChild(newEntry);
                        
                        // Reset the form
                        newProfitAmount.value = '';
                        
                        // Set up the delete button
                        setupDeleteButton(newEntry.querySelector('.remove-entry-btn'));
                        
                        // Show success message
                        showAlert('success', 'Profit entry added successfully');
                        
                        // Refresh the chart (in a real implementation)
                        // refreshProfitChart();
                    } else {
                        showAlert('danger', 'Error: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showAlert('danger', 'An error occurred while adding the profit entry');
                });
            });
            
            // Function to set up delete buttons
            function setupDeleteButton(button) {
                button.addEventListener('click', function() {
                    const entryId = this.dataset.id;
                    
                    // Send AJAX request to delete profit entry
                    fetch('{% url "startup:delete_profit_entry" %}', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCsrfToken()
                        },
                        body: JSON.stringify({ profit_id: entryId })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Remove the entry from the UI
                            const entryElement = document.querySelector(`.profit-entry[data-id="${entryId}"]`);
                            if (entryElement) {
                                entryElement.remove();
                                if (profitEntriesContainer.children.length === 0) {
                                    profitEntriesContainer.innerHTML = '<p>No profit history entries yet. Add your first entry below.</p>';
                                }
                                
                                // Show success message
                                showAlert('success', 'Profit entry deleted successfully');
                                
                                // Refresh the chart (in a real implementation)
                                // refreshProfitChart();
                            }
                        } else {
                            showAlert('danger', 'Error: ' + data.error);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showAlert('danger', 'An error occurred while deleting the profit entry');
                    });
                });
            }
            
            // Set up existing delete buttons
            document.querySelectorAll('.remove-entry-btn').forEach(setupDeleteButton);
            
            // Helper function to get CSRF token
            function getCsrfToken() {
                return document.querySelector('[name=csrfmiddlewaretoken]').value;
            }
            
            // Helper function to show alerts
            function showAlert(type, message) {
                const alertContainer = document.createElement('div');
                alertContainer.className = `alert alert-${type} alert-dismissible fade show`;
                alertContainer.role = 'alert';
                alertContainer.innerHTML = `
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                `;
                
                // Add the alert to the page
                const formSection = document.querySelector('.form-section');
                formSection.parentNode.insertBefore(alertContainer, formSection);
                
                // Auto dismiss after 5 seconds
                setTimeout(() => {
                    alertContainer.classList.remove('show');
                    setTimeout(() => alertContainer.remove(), 500);
                }, 5000);
            }
        }
        
        // Initialize profit chart if data is available
        const profitChart = document.getElementById('profitChart');
        if (profitChart) {
            // Use the global variables we defined in the earlier script tag
            if (profitLabels.length > 0 && profitValues.length > 0) {
                new Chart(profitChart, {
                    type: 'line',
                    data: {
                        labels: profitLabels,
                        datasets: [{
                            label: 'Monthly Profit ($)',
                            data: profitValues,
                            backgroundColor: 'rgba(24, 203, 150, 0.2)',
                            borderColor: 'rgba(24, 203, 150, 1)',
                            borderWidth: 2,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value;
                                    }
                                }
                            }
                        }
                    }
                });
            } else {
                profitChart.parentElement.innerHTML = '<p class="text-center my-5">No profit data available yet. Add monthly entries to see your profit trend.</p>';
            }
        }
    });
</script>
{% endblock %} 